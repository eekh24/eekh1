<!DOCTYPE html>
<html>
<head>
  <meta name="viewport" content="width=device-width, initial-scale=1.0">
  <style>
    /* Your existing styles */
    * {
    box-sizing: border-box;
  }

  body {
    font-family: Arial, sans-serif;
    margin: 0;
    padding: 0;
  }

  /* Styles for form container */
  .container {
    width: 100%;
    max-width: 400px; /* Set maximum width of the form container */
    margin: auto;
    padding: 20px;
  }
  
  /* Styles for form inputs */
  input[type=date], input[type=number], input[type=text], input[type=password] {
    width: 100%;
    padding: 12px 20px;
    margin: 8px 0;
    border: 1px solid #ccc;
    border-radius: 4px;
    box-sizing: border-box;
  }

  /* Styles for submit button */
  input[type=submit], button {
    width: 100%;
    background-color: #4CAF50;
    color: white;
    padding: 14px 20px;
    margin: 8px 0;
    border: none;
    border-radius: 4px;
    cursor: pointer;
  }

  input[type=submit]:hover, button:hover {
    background-color: #45a049;
  }

  /* Styles for message div */
  #message {
    margin-top: 20px;
    font-weight: bold;
    text-align: center;
  }

  /* Media query for smaller screens */
  @media screen and (max-width: 600px) {
    .container {
      padding: 10px;
    }
  }

  /* Styles for modal */
  .modal {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
  }

  .modals {
    display: none;
    position: fixed;
    z-index: 1;
    left: 0;
    top: 0;
    width: 100%;
    height: 100%;
    overflow: auto;
    background-color: rgba(0, 0, 0, 0.4);
  }

  .modal-content {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    color:green;
    width: 80%;
    max-width: 600px;
    text-align: center;
  }

  .modal-contents {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    color:red;
    width: 80%;
    max-width: 600px;
    text-align: center;
  }

  .modal-contentss {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    color:red;
    width: 80%;
    max-width: 600px;
    text-align: center;
  }

  .modal-contentsss {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    color:red;
    width: 80%;
    max-width: 600px;
    text-align: center;
  }

  .modal-contentssss {
    background-color: #fefefe;
    margin: 15% auto;
    padding: 20px;
    border: 1px solid #888;
    color:red;
    width: 80%;
    max-width: 600px;
    text-align: center;
  }

  .close {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .closes {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .closess {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .closesss {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }

  .closessss {
    color: #aaa;
    float: right;
    font-size: 28px;
    font-weight: bold;
  }


  .close:hover,
  .close:focus {
    color: black;
    text-decoration: none;
    cursor: pointer;
  }

  big {
    color: green;
  }

  #topBar{
    
    
    height: 60px;
    width: 100%;
    
  }

  #topBar h4 {
            color: green;
            margin-left: 32%;
            margin-top: 30px;
            margin-bottom: 10px;
            font-size: 50px;
        }


  #signup{
    align-self: center;
    justify-self: center;
    margin-left: 16%;
    color: blue;
  }
  </style>
</head>
<body>
  <div id="topBar" >
    <h4>eekh</h4>
  </div>
  <h3><pre>    
    Thank you for contacting eekh!
     Please Fill the Below Feilds
    You will get <big><big><u>*Rs.100 off*</u></big></big> 
          </pre></h3>
  <div class="container">
    <h3>Login</h3>
    <form id="login-form">
      <input type="text" id="mobile" name="mobile" required placeholder="Please Enter Your Mobile Number" maxlength="10"/>
      
      <input type="password" id="password" name="password" required placeholder="Please Enter Your Password"/>
      <button type="submit">Login</button>
      <p id="signup" >Not Registered Yet? Sign Up Here</p>
      
    </form>
    <button id="forgotpassword" >Forgot Password?</button>
    <div id="message"></div>
    <p><u><b>Our Servings</b></u></p>
      
      <hr>
    <pre><b>1.  <a href ="cake.html">Cake</a></b></pre>
    <pre><b>2.  <a href ="pizza.html">Pizza</a></b></pre>
    <pre><b>3.  <a href ="index.html">Ice Cream</a></b></pre>
    <pre><b>4.  <a href ="index.html">Cold Coffee</a></b></pre>
  </div>

  <h3><pre>  Cake</pre></h3>
  <hr>
    <img src="cake1.jpeg" alt="image" style="width:49%; margin-top:5px;"> <img src="cake2.jpeg" alt="image" style="width:49%; margin-top:5px;">
    <img src="cake3.jpeg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake4.jpeg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake10.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake9.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake6.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake7.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake12.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake14.jpg" alt="image" style="width:49%; margin-top:2px;">
      <hr>
  <h3><pre>  Layer Cake</pre></h3>
      <hr>
    <img src="cake32.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake36.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake33.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake5.jpeg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake30.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake35.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake34.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake37.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake38.jpg" alt="image" style="width:49%; margin-top:2px;"> 
    <hr>
    <h3><pre>  Anniversary Cake</pre></h3>
    <hr>
  <img src="cake16.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake11.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake15.jpg" alt="image" style="width:49%; margin-top:2px;"> 
    <hr>
    <h3><pre>  Girls Cake</pre></h3>
    <hr>
  <img src="cake31.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake42.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake18.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake19.jpg" alt="image" style="width:49%; margin-top:2px;">
    <hr>
    <h3><pre>  Boys Cake</pre></h3>
    <hr>
  <img src="cake39.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake29.jpg" alt="image" style="width:49%; margin-top:2px;">
  <img src="cake8.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake24.jpg" alt="image" style="width:49%; margin-top:2px;">
  <img src="cake41.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake40.jpg" alt="image" style="width:49%; margin-top:2px;"> 
   <img src="cake28.jpg" alt="image" style="width:49%; margin-top:2px;"> 
    <hr>
    <h3><pre>  Photo Cake</pre></h3>
    <hr>
  <img src="cake20.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake22.jpg" alt="image" style="width:49%; margin-top:2px;">
    <img src="cake21.jpg" alt="image" style="width:49%; margin-top:2px;"> <img src="cake23.jpg" alt="image" style="width:49%; margin-top:2px;">
  
    <div id="resetPasswordModal" class="modal">
      <div class="modal-content">
          <span class="close" id="closeresetmodal">&times;</span>
          <h2>Reset Password</h2>
          <input type="text" id="reset-mobile" placeholder="Enter your registered mobile number" required>
          <button id="sendOtpButton">Send OTP</button>

          <div id="otpSection" style="display:none;">
              <input type="text" id="otp" placeholder="Enter OTP" required>
              <button id="verifyotp">Verify OTP</button>
          </div>

          <div id="newPasswordSection" style="display:none;">
              <input type="password" id="new-password" placeholder="Enter new password" required>
              <button id="resetpassword">Reset Password</button>
          </div>
      </div>
  </div>

  <script type="module">
    import { initializeApp } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-app.js';
    import { getFirestore, doc, getDoc } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-firestore.js';
    import { getAuth, signInWithPhoneNumber, RecaptchaVerifier } from 'https://www.gstatic.com/firebasejs/9.0.0/firebase-auth.js';

    const firebaseConfig = {
      apiKey: "AIzaSyDjpg5dNL6R44dPpoDQabNaT8tLVmVWTQQ",
      authDomain: "eekh-website.firebaseapp.com",
      projectId: "eekh-website",
      storageBucket: "eekh-website.appspot.com",
      messagingSenderId: "276234231567",
      appId: "1:276234231567:web:1509267f60d97a83cea87a",
      measurementId: "G-QX5HCKXMDK"
    };

    const app = initializeApp(firebaseConfig);
    const db = getFirestore(app);
    const auth = getAuth(app);

    const loginForm = document.getElementById('login-form');
    const messageDiv = document.getElementById('message');
    let currentResetMobile = null;  // To store the mobile number for the current reset process
    let otpVerificationId = null;   // To store the verification ID after sending OTP


    loginForm.addEventListener('submit', async (e) => {
      e.preventDefault();
      const mobile = loginForm.mobile.value;
      const password = loginForm.password.value;
     // const name = document.getElementById('signup-name').value;

      try {
        const userRef = doc(db, 'users', mobile);
        const docSnap = await getDoc(userRef);

        if (docSnap.exists()) {
          const userData = docSnap.data();
          if (userData.password === password) {
            // Redirect to login.html if credentials match
            window.location.href = `login.html?mobile=${encodeURIComponent(mobile)}`;
          } else {
            alert('Mobile Number or Password is Incorrect!! Please Try Again')
           // messageDiv.textContent = 'Mobile Number or Password is Incorrect!! Please Try Again';

          }
        } else {
         // messageDiv.textContent = 'User not found. Please check your mobile number.';
         alert('Not Registered!! Please Sign Up')
         window.location.href = 'signUp.html';
          
        }
      } catch (error) {
        console.error('Error signing in:', error);
        alert('Error signing in. Please try again.')
       // messageDiv.textContent = 'Error signing in. Please try again.';
        
      }
    });

    document.getElementById('signup').addEventListener('click', () =>{
      window.location.href = 'signUp.html';
    })

    function openResetModal() {
            document.getElementById('resetPasswordModal').style.display = 'block';
        }

        document.getElementById('forgotpassword').addEventListener('click', () =>{
           openResetModal()
        })

        document.getElementById('sendOtpButton').addEventListener('click', () =>{
            sendOtp()
        })

        document.getElementById('verifyotp').addEventListener('click', () =>{
            verifyOtp()
        })

        document.getElementById('resetpassword').addEventListener('click', () =>{
            resetPassword()
        })

        document.getElementById('closeresetmodal').addEventListener('click', () =>{
            closeResetModal()
        })

        function closeResetModal() {
            document.getElementById('resetPasswordModal').style.display = 'none';
        }

        function sendOtp() {
            const mobile = document.getElementById('reset-mobile').value;

            // Verify if the mobile number is registered
            const userRef = doc(db, 'users', mobile);
            getDoc(userRef).then((docSnap) => {
                if (docSnap.exists()) {
                    // Mobile number exists, proceed to send OTP
                    currentResetMobile = mobile;

                    // Set up reCAPTCHA
                    window.recaptchaVerifier = new RecaptchaVerifier('sendOtpButton', {
                        'size': 'invisible',
                        'callback': () => {
                            // reCAPTCHA solved, allow send OTP
                        }
                    }, auth);

                    // Send OTP to the mobile number
                    const appVerifier = window.recaptchaVerifier;
                    signInWithPhoneNumber(auth, `+91${mobile}`, appVerifier)
                        .then((confirmationResult) => {
                            otpVerificationId = confirmationResult.verificationId;
                            document.getElementById('otpSection').style.display = 'block';
                        })
                        .catch((error) => {
                          alert('Error sending OTP: ', error);
                            console.error('Error sending OTP: ', error);
                        });
                } else {
                    alert('Mobile number is not registered!');
                }
            });
        }

        function verifyOtp() {
            const otp = document.getElementById('otp').value;

            if (otpVerificationId && otp) {
                const credential = firebase.auth.PhoneAuthProvider.credential(otpVerificationId, otp);

                auth.signInWithCredential(credential)
                    .then(() => {
                        // OTP is correct, allow user to reset password
                        document.getElementById('newPasswordSection').style.display = 'block';
                    })
                    .catch((error) => {
                        console.error('Error verifying OTP: ', error);
                        alert('Invalid OTP!');
                    });
            }
        }

        function resetPassword() {
            const newPassword = document.getElementById('new-password').value;

            if (currentResetMobile && newPassword) {
                const userRef = doc(db, 'users', currentResetMobile);

                updateDoc(userRef, { password: newPassword })
                    .then(() => {
                        alert('Password reset successfully!');
                        closeResetModal();
                    })
                    .catch((error) => {
                        console.error('Error resetting password: ', error);
                        alert('Failed to reset password!');
                    });
            }
        }

  </script>

</body>
</html>
